import fs from "fs";
import path from "path";
import Currency from "../src/currency";
import ISOCurrencyList from "../src/currencylists/iso";
import BitcoinCurrencyList from "../src/currencylists/bitcoin";
import AggregateCurrencyList from "../src/currencylists/aggregate";

let code = `// IMPORTANT:
// This file is autogenerated by generate-money-factory.ts
// DO NOT modify directly as your changes will be overwritten

import Money from "./money";
import Currency from "./currency";

function moneyFactory(amount: number, currencyCode: string): Money {
    return new Money(amount, new Currency(currencyCode));
}

`;

const isoCurrenciesJson = fs.readFileSync(process.argv[2], "utf8");
const isoCurrenciesData = JSON.parse(isoCurrenciesJson);
const isoCurrencyList = new ISOCurrencyList(isoCurrenciesData);

const bitcoinCurrencyList = new BitcoinCurrencyList();
const currencyList = new AggregateCurrencyList([
    isoCurrencyList,
    bitcoinCurrencyList,
]);

const currencies: Currency[] = Array.from(currencyList);
currencies.sort();

for (const currency of currencies) {
    code += "export const " + currency.code + " = (amount: number) => moneyFactory(amount, '" + currency.code + "'); // " + currencyList.nameFor(currency) + "\n";
}

fs.writeFileSync(path.join(__dirname, "..", "src", "moneyfactory.ts"), code);
